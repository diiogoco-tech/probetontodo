<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Probeton To DO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #050816;
      --bg-card-soft: #020617;
      --primary-yellow: #facc15;
      --primary-amber: #f59e0b;
      --primary-orange: #f97316;
      --accent-soft: #fed7aa;
      --border-soft: #1f2937;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --tag-yellow: #fef9c3;
      --tag-yellow-text: #854d0e;
      --tag-gray: #e5e7eb;
      --tag-gray-text: #111827;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.6);
      --radius-lg: 18px;
      --radius-full: 999px;
      --transition-fast: 160ms ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
    }

    .app-shell {
      display: grid;
      grid-template-columns: 260px minmax(0, 1.9fr) minmax(0, 1.2fr);
      gap: 20px;
      width: 100%;
      max-width: 1300px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      border: 1px solid rgba(248, 250, 252, 0.06);
      box-shadow: var(--shadow-soft);
      padding: 18px;
      backdrop-filter: blur(20px);
    }

    .app-header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border-soft);
      margin-bottom: 4px;
    }

    .app-title-group {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-pill {
      width: 46px;
      height: 46px;
      border-radius: 16px;
      background: radial-gradient(circle at 20% 0%, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 22px;
      box-shadow: 0 16px 40px rgba(250, 204, 21, 0.6);
      color: #111827;
    }

    .app-title-text h1 {
      font-size: 20px;
      letter-spacing: 0.05em;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
    }

    .app-title-text h1 span.highlight {
      background: linear-gradient(90deg, #facc15, #f97316);
      -webkit-background-clip: text;
      color: transparent;
    }

    .app-title-text p {
      font-size: 12px;
      color: var(--text-muted);
    }

    .app-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .today-pill {
      padding: 6px 12px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-soft);
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(15, 23, 42, 0.9);
    }

    .today-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #facc15, #f97316);
      box-shadow: 0 0 16px rgba(250, 204, 21, 0.9);
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: linear-gradient(135deg, #facc15, #f97316);
      border: 2px solid #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      color: #111827;
    }

    .sidebar {
      border-right: 1px solid var(--border-soft);
      padding-right: 16px;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    .panel-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .sidebar-section {
      background: linear-gradient(145deg, rgba(5, 8, 22, 0.98), rgba(15, 23, 42, 0.9));
      padding: 14px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(55, 65, 81, 0.8);
    }

    .filter-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-chip {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 13px;
      border: 1px solid transparent;
      transition: background var(--transition-fast), border var(--transition-fast), transform 120ms ease-out;
    }

    .filter-chip span.label {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-chip .icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.9);
    }

    .filter-chip .count {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.9);
      color: var(--text-muted);
    }

    .filter-chip.active {
      background: radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.35), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(250, 204, 21, 0.8);
    }

    .filter-chip:hover {
      background: rgba(31, 41, 55, 0.95);
      transform: translateY(-1px);
    }

    .sidebar-metrics {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .metric-card {
      background: linear-gradient(145deg, #020617, #050816);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid #1f2937;
      font-size: 11px;
    }

    .metric-label {
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 16px;
      font-weight: 700;
    }

    .metric-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      margin-top: 3px;
      padding: 2px 6px;
      border-radius: 999px;
    }

    .metric-tag.up {
      background: rgba(250, 204, 21, 0.18);
      color: #fef9c3;
    }

    .metric-tag.down {
      background: rgba(148, 163, 184, 0.18);
      color: #e5e7eb;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .tag-pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
    }

    .tag-pill.yellow {
      background: var(--tag-yellow);
      color: var(--tag-yellow-text);
      border-color: rgba(250, 204, 21, 0.7);
    }

    .main {
      padding: 0 10px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .add-bar {
      background: linear-gradient(135deg, rgba(5, 8, 22, 0.98), rgba(15, 23, 42, 0.95));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 10px 14px;
      display: flex;
      align-items: stretch;
      gap: 10px;
    }

    .add-input-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 6px 10px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .add-input-wrapper span.icon-plus {
      background: radial-gradient(circle at 20% 0, #facc15, #f97316);
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #111827;
      font-weight: 700;
    }

    .add-input-wrapper input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-size: 13px;
    }

    .add-input-wrapper input::placeholder {
      color: var(--text-muted);
    }

    .add-input-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .add-input-meta span {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .btn-primary {
      padding: 0 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #facc15, #f97316);
      color: #111827;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 25px rgba(250, 204, 21, 0.55);
      transition: transform 120ms ease-out, box-shadow 120ms ease-out, filter 120ms ease-out;
      white-space: nowrap;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 14px 30px rgba(250, 204, 21, 0.65);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 6px 16px rgba(250, 204, 21, 0.5);
    }

    .btn-ghost {
      padding: 0 12px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      cursor: pointer;
      font-size: 12px;
      background: transparent;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: background var(--transition-fast), border var(--transition-fast), color var(--transition-fast);
    }

    .btn-ghost:hover {
      background: rgba(31, 41, 55, 0.95);
      border-color: rgba(75, 85, 99, 0.9);
      color: var(--text-main);
    }

    .task-section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-top: 2px;
    }

    .task-section-header h2 {
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .task-section-header span {
      font-size: 11px;
      color: var(--text-muted);
    }

    .task-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .task-card {
      display: grid;
      grid-template-columns: auto minmax(0, 1.7fr) minmax(0, 1.1fr);
      gap: 10px;
      padding: 8px 10px;
      border-radius: 14px;
      background: radial-gradient(circle at 0 0, rgba(15, 23, 42, 0.98), rgba(5, 8, 22, 0.98));
      border: 1px solid rgba(31, 41, 55, 0.9);
      align-items: center;
      font-size: 13px;
      transition: border var(--transition-fast), transform 120ms ease-out, background 120ms ease-out;
      cursor: pointer;
    }

    .task-card:hover {
      border-color: rgba(250, 204, 21, 0.8);
      transform: translateY(-1px);
      background: radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.06), rgba(5, 8, 22, 0.98));
    }

    .task-card.completed {
      opacity: 0.8;
      background: linear-gradient(90deg, rgba(5, 8, 22, 0.98), rgba(251, 191, 36, 0.18));
      border-color: rgba(250, 204, 21, 0.8);
    }

    .task-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .task-checkbox {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 11px;
      background: radial-gradient(circle at 30% 0, rgba(15, 23, 42, 1), rgba(15, 23, 42, 1));
    }

    .task-checkbox.checked {
      background: radial-gradient(circle at 30% 0, #facc15, #f97316);
      border-color: rgba(250, 204, 21, 0.9);
      box-shadow: 0 0 12px rgba(250, 204, 21, 0.8);
      color: #111827;
    }

    .task-title {
      font-weight: 500;
    }

    .task-title.completed {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .task-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .task-center {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      justify-content: flex-start;
    }

    .badge {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border: 1px solid transparent;
    }

    .badge-priority-high {
      background: rgba(248, 113, 22, 0.15);
      color: #fed7aa;
      border-color: rgba(249, 115, 22, 0.9);
    }

    .badge-priority-normal {
      background: rgba(148, 163, 184, 0.15);
      color: #e5e7eb;
      border-color: rgba(156, 163, 175, 0.9);
    }

    .badge-due-today {
      background: rgba(250, 204, 21, 0.12);
      color: #fef9c3;
      border-color: rgba(250, 204, 21, 0.8);
    }

    .badge-tag {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      border-color: rgba(31, 41, 55, 0.9);
    }

    .task-right {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .pill-soft {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      color: var(--text-muted);
    }

    .pill-soft.yellow {
      border-color: rgba(250, 204, 21, 0.7);
      color: #fef9c3;
    }

    .pill-soft.gray {
      border-color: rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
    }

    .kanban-wrapper {
      margin-top: 14px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 10px;
      background: linear-gradient(135deg, rgba(5, 8, 22, 0.98), rgba(15, 23, 42, 0.95));
    }

    .kanban-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .kanban-header h3 {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .kanban-columns {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    .kanban-column {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 14px;
      padding: 8px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 120px;
    }

    .kanban-column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .kanban-column-header span.count {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.9);
    }

    .kanban-dropzone {
      flex: 1;
      min-height: 80px;
      border-radius: 12px;
      padding: 4px;
      transition: background var(--transition-fast), border var(--transition-fast);
    }

    .kanban-dropzone.over {
      border: 1px dashed rgba(250, 204, 21, 0.9);
      background: rgba(31, 41, 55, 0.9);
    }

    .kanban-card {
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 10px;
      background: radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.18), rgba(5, 8, 22, 0.98));
      border: 1px solid rgba(55, 65, 81, 0.9);
      margin-bottom: 4px;
      cursor: grab;
    }

    .kanban-card.doing {
      background: radial-gradient(circle at 0 0, rgba(249, 115, 22, 0.2), rgba(5, 8, 22, 0.98));
      border-color: rgba(249, 115, 22, 0.8);
    }

    .kanban-card.done {
      background: linear-gradient(90deg, rgba(5, 8, 22, 0.98), rgba(250, 204, 21, 0.3));
      border-color: rgba(250, 204, 21, 0.9);
      opacity: 0.85;
    }

    .kanban-card-title {
      font-weight: 500;
      margin-bottom: 2px;
    }

    .kanban-card-meta {
      font-size: 10px;
      color: var(--text-muted);
    }

    .right {
      border-left: 1px solid var(--border-soft);
      padding-left: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .detail-card {
      background: radial-gradient(circle at 0 0, rgba(250, 204, 21, 0.2), rgba(5, 8, 22, 0.98));
      border-radius: var(--radius-lg);
      padding: 14px;
      border: 1px solid rgba(250, 204, 21, 0.7);
      box-shadow: 0 16px 30px rgba(250, 204, 21, 0.3);
      font-size: 12px;
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .detail-header h3 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .detail-header span {
      font-size: 11px;
      color: #fef9c3;
    }

    .detail-group {
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .detail-label {
      font-size: 11px;
      color: #fef9c3;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .detail-input,
    .detail-textarea,
    .detail-select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 12px;
      padding: 6px 8px;
      outline: none;
    }

    .detail-textarea {
      resize: vertical;
      min-height: 48px;
      max-height: 120px;
    }

    .detail-inline {
      display: flex;
      gap: 8px;
    }

    .detail-inline .detail-group {
      flex: 1;
    }

    .detail-small {
      font-size: 11px;
      color: var(--text-muted);
    }

    .file-input {
      font-size: 11px;
      color: var(--text-muted);
    }

    .attachment-list {
      list-style: none;
      margin-top: 4px;
      max-height: 80px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .attachment-item {
      font-size: 11px;
      color: #fef9c3;
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(250, 204, 21, 0.6);
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .detail-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 6px;
    }

    .history-card {
      background: linear-gradient(145deg, #020617, #050816);
      border-radius: var(--radius-lg);
      padding: 12px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      font-size: 11px;
      max-height: 170px;
      overflow-y: auto;
    }

    .history-card h4 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .history-entry {
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 1px dashed rgba(31, 41, 55, 0.7);
    }

    .history-entry:last-child {
      border-bottom: none;
    }

    .history-time {
      color: var(--text-muted);
      font-size: 10px;
    }

    .history-text {
      color: var(--text-main);
      font-size: 11px;
    }

    .right-section-card {
      background: linear-gradient(145deg, #020617, #050816);
      border-radius: var(--radius-lg);
      padding: 12px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      font-size: 12px;
    }

    .right-section-card h4 {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .right-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .right-row strong {
      font-size: 13px;
    }

    .progress-bar {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      margin-top: 4px;
      overflow: hidden;
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .progress-bar-inner {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #facc15, #f97316);
      transition: width 200ms ease-out;
    }

    @media (max-width: 980px) {
      .app-shell {
        grid-template-columns: 1fr;
        padding: 12px;
      }
      .sidebar {
        border-right: none;
        border-bottom: 1px solid var(--border-soft);
        padding-bottom: 12px;
        margin-bottom: 8px;
      }
      .right {
        border-left: none;
        border-top: 1px solid var(--border-soft);
        padding-left: 0;
        padding-top: 12px;
      }
      .kanban-columns {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title-group">
        <div class="logo-pill">PB</div>
        <div class="app-title-text">
          <h1>
            Probeton <span class="highlight">To DO</span>
          </h1>
          <p>Pipeline de tarefas com Kanban, respons√°veis, datas, arquivos e hist√≥rico.</p>
        </div>
      </div>
      <div class="app-header-right">
        <div class="today-pill">
          <div class="today-dot"></div>
          <span id="today-label">Hoje</span>
        </div>
        <div class="avatar">DO</div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="panel-title">Vis√£o geral</div>
        <div class="filter-list">
          <div class="filter-chip active" data-filter="all">
            <span class="label">
              <span class="icon">‚úì</span>
              Tudo
            </span>
            <span class="count" id="count-all">0</span>
          </div>
          <div class="filter-chip" data-filter="today">
            <span class="label">
              <span class="icon">‚òÄ</span>
              Hoje
            </span>
            <span class="count" id="count-today">0</span>
          </div>
          <div class="filter-chip" data-filter="week">
            <span class="label">
              <span class="icon">üìÖ</span>
              Semana
            </span>
            <span class="count" id="count-week">0</span>
          </div>
          <div class="filter-chip" data-filter="done">
            <span class="label">
              <span class="icon">‚úî</span>
              Conclu√≠das
            </span>
            <span class="count" id="count-done">0</span>
          </div>
        </div>
        <div class="sidebar-metrics">
          <div class="metric-card">
            <div class="metric-label">Pendentes hoje</div>
            <div class="metric-value" id="metric-today-left">0</div>
            <div class="metric-tag up">Foco</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Conclu√≠das</div>
            <div class="metric-value" id="metric-done">0</div>
            <div class="metric-tag down">Limpeza</div>
          </div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="panel-title">Etiquetas r√°pidas</div>
        <div class="tag-list">
          <button class="tag-pill yellow">Alta prioridade</button>
          <button class="tag-pill">Trabalho</button>
          <button class="tag-pill">Pessoal</button>
          <button class="tag-pill">Reuni√£o</button>
          <button class="tag-pill">Cliente</button>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="add-bar">
        <div class="add-input-wrapper">
          <span class="icon-plus">+</span>
          <input id="new-task-input" type="text" placeholder="Criar uma nova tarefa r√°pida (ex: 'Enviar proposta Yp√™')" />
        </div>
        <div class="add-input-meta">
          <span>Hoje</span>
          <span>Normal</span>
        </div>
        <button class="btn-primary" id="add-task-btn">
          Adicionar
        </button>
        <button class="btn-ghost" id="clear-done-btn">
          Limpar conclu√≠das
        </button>
      </div>

      <div class="task-section-header">
        <h2>Lista de tarefas</h2>
        <span id="summary-text">Nenhuma tarefa ainda.</span>
      </div>

      <div class="task-list" id="task-list"></div>

      <div class="kanban-wrapper">
        <div class="kanban-header">
          <h3>Kanban Probeton</h3>
          <span style="font-size:11px;color:var(--text-muted);">
            Arraste as tarefas entre Backlog, Em Andamento e Conclu√≠das
          </span>
        </div>
        <div class="kanban-columns">
          <div class="kanban-column" data-status="backlog">
            <div class="kanban-column-header">
              <span>Backlog</span>
              <span class="count" id="kanban-backlog-count">0</span>
            </div>
            <div class="kanban-dropzone" data-status="backlog"></div>
          </div>
          <div class="kanban-column" data-status="doing">
            <div class="kanban-column-header">
              <span>Em andamento</span>
              <span class="count" id="kanban-doing-count">0</span>
            </div>
            <div class="kanban-dropzone" data-status="doing"></div>
          </div>
          <div class="kanban-column" data-status="done">
            <div class="kanban-column-header">
              <span>Conclu√≠das</span>
              <span class="count" id="kanban-done-count">0</span>
            </div>
            <div class="kanban-dropzone" data-status="done"></div>
          </div>
        </div>
      </div>
    </main>

    <section class="right">
      <div class="detail-card">
        <div class="detail-header">
          <h3>Detalhes da tarefa</h3>
          <span id="detail-status-label">Nenhuma tarefa selecionada</span>
        </div>

        <div class="detail-group">
          <div class="detail-label">T√≠tulo</div>
          <input id="detail-title" class="detail-input" placeholder="Selecione uma tarefa na lista" />
        </div>

        <div class="detail-group">
          <div class="detail-label">Descri√ß√£o</div>
          <textarea id="detail-desc" class="detail-textarea" placeholder="Contexto, pontos importantes, pr√≥ximos passos"></textarea>
        </div>

        <div class="detail-inline">
          <div class="detail-group">
            <div class="detail-label">Respons√°vel</div>
            <input id="detail-resp" class="detail-input" placeholder="Ex: Diogo, Pedro, Gabi" />
          </div>
          <div class="detail-group">
            <div class="detail-label">Data</div>
            <input id="detail-date" type="date" class="detail-input" />
          </div>
        </div>

        <div class="detail-inline">
          <div class="detail-group">
            <div class="detail-label">Prioridade</div>
            <select id="detail-priority" class="detail-select">
              <option value="normal">Normal</option>
              <option value="high">Alta</option>
            </select>
          </div>
          <div class="detail-group">
            <div class="detail-label">Status (Kanban)</div>
            <select id="detail-status" class="detail-select">
              <option value="backlog">Backlog</option>
              <option value="doing">Em andamento</option>
              <option value="done">Conclu√≠da</option>
            </select>
          </div>
        </div>

        <div class="detail-group">
          <div class="detail-label">Arquivos</div>
          <input id="detail-files" type="file" multiple class="file-input" />
          <div class="detail-small">Os arquivos s√£o apenas listados localmente (n√£o s√£o enviados para servidor).</div>
          <ul id="attachment-list" class="attachment-list"></ul>
        </div>

        <div class="detail-footer">
          <button class="btn-primary" id="detail-save-btn">Salvar detalhes</button>
        </div>
      </div>

      <div class="history-card">
        <h4>Hist√≥rico</h4>
        <div id="history-list">
          <div class="detail-small">Selecione uma tarefa para ver o hist√≥rico de altera√ß√µes.</div>
        </div>
      </div>

      <div class="right-section-card">
        <h4>Resumo geral</h4>
        <div class="right-row">
          <span>Total de tarefas</span>
          <strong id="right-total">0</strong>
        </div>
        <div class="right-row">
          <span>Conclu√≠das</span>
          <strong id="right-done">0</strong>
        </div>
        <div class="right-row">
          <span>Pendentes</span>
          <strong id="right-pending">0</strong>
        </div>
        <div class="right-row">
          <span>Conclu√≠das hoje</span>
          <strong id="right-done-today">0</strong>
        </div>
        <div class="progress-bar">
          <div class="progress-bar-inner" id="bar-done-today" style="width: 0%;"></div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const state = {
      filter: 'all',
      currentTaskId: null,
      tasks: [
        {
          id: 1,
          title: 'Revisar pipeline de obras',
          description: 'Conferir prioridades da semana e atualizar status no Probeton To DO.',
          due: 'today',
          dueDate: null,
          priority: 'normal',
          tag: 'Trabalho',
          responsible: 'Diogo',
          completed: false,
          status: 'backlog',
          attachments: [],
          history: []
        },
        {
          id: 2,
          title: 'Enviar proposta para cliente industrial',
          description: 'Revisar escopo, custos e prazo antes de enviar para o cliente.',
          due: 'today',
          dueDate: null,
          priority: 'high',
          tag: 'Cliente',
          responsible: 'Diogo',
          completed: false,
          status: 'doing',
          attachments: [],
          history: []
        },
        {
          id: 3,
          title: 'Reuni√£o interna com equipe',
          description: 'Alinhar cronograma e riscos das obras em andamento.',
          due: 'week',
          dueDate: null,
          priority: 'normal',
          tag: 'Reuni√£o',
          responsible: 'Equipe',
          completed: false,
          status: 'backlog',
          attachments: [],
          history: []
        },
        {
          id: 4,
          title: 'Organizar documentos de uma obra',
          description: 'Arquivar RDOs, ARTs, relat√≥rios de seguran√ßa e fotos.',
          due: 'week',
          dueDate: null,
          priority: 'normal',
          tag: 'Trabalho',
          responsible: 'Pedro',
          completed: true,
          status: 'done',
          attachments: [],
          history: []
        }
      ]
    };

    const els = {
      todayLabel: document.getElementById('today-label'),
      taskList: document.getElementById('task-list'),
      summaryText: document.getElementById('summary-text'),
      newTaskInput: document.getElementById('new-task-input'),
      addTaskBtn: document.getElementById('add-task-btn'),
      clearDoneBtn: document.getElementById('clear-done-btn'),
      filters: document.querySelectorAll('.filter-chip'),
      countAll: document.getElementById('count-all'),
      countToday: document.getElementById('count-today'),
      countWeek: document.getElementById('count-week'),
      countDone: document.getElementById('count-done'),
      metricTodayLeft: document.getElementById('metric-today-left'),
      metricDone: document.getElementById('metric-done'),
      kanbanDropzones: document.querySelectorAll('.kanban-dropzone'),
      kanbanBacklogCount: document.getElementById('kanban-backlog-count'),
      kanbanDoingCount: document.getElementById('kanban-doing-count'),
      kanbanDoneCount: document.getElementById('kanban-done-count'),
      detailStatusLabel: document.getElementById('detail-status-label'),
      detailTitle: document.getElementById('detail-title'),
      detailDesc: document.getElementById('detail-desc'),
      detailResp: document.getElementById('detail-resp'),
      detailDate: document.getElementById('detail-date'),
      detailPriority: document.getElementById('detail-priority'),
      detailStatus: document.getElementById('detail-status'),
      detailFiles: document.getElementById('detail-files'),
      attachmentList: document.getElementById('attachment-list'),
      detailSaveBtn: document.getElementById('detail-save-btn'),
      historyList: document.getElementById('history-list'),
      rightTotal: document.getElementById('right-total'),
      rightDone: document.getElementById('right-done'),
      rightPending: document.getElementById('right-pending'),
      rightDoneToday: document.getElementById('right-done-today'),
      barDoneToday: document.getElementById('bar-done-today')
    };

    function formatTodayLabel() {
      const today = new Date();
      const formatter = new Intl.DateTimeFormat('pt-BR', {
        weekday: 'short',
        day: '2-digit',
        month: '2-digit'
      });
      els.todayLabel.textContent = formatter.format(today);
    }

    function addHistory(task, message) {
      if (!task.history) task.history = [];
      task.history.unshift({
        timestamp: new Date().toISOString(),
        message
      });
    }

    function formatDateTime(ts) {
      const d = new Date(ts);
      if (isNaN(d)) return '';
      const date = d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
      const time = d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      return `${date} ‚Ä¢ ${time}`;
    }

    function getVisibleTasks() {
      if (state.filter === 'all') return state.tasks;
      if (state.filter === 'today') return state.tasks.filter(t => t.due === 'today');
      if (state.filter === 'week') return state.tasks.filter(t => t.due === 'week');
      if (state.filter === 'done') return state.tasks.filter(t => t.completed);
      return state.tasks;
    }

    function labelFromFilter(filter) {
      if (filter === 'all') return 'Todas';
      if (filter === 'today') return 'Hoje';
      if (filter === 'week') return 'Esta semana';
      if (filter === 'done') return 'Conclu√≠das';
      return filter;
    }

    function renderTasks() {
      const visible = getVisibleTasks();
      els.taskList.innerHTML = '';

      if (visible.length === 0) {
        els.summaryText.textContent = 'Nenhuma tarefa nesta vis√£o.';
      } else {
        els.summaryText.textContent = `${visible.length} tarefa(s) na vis√£o "${labelFromFilter(state.filter)}".`;
      }

      visible.forEach(task => {
        const card = document.createElement('div');
        card.className = 'task-card' + (task.completed ? ' completed' : '');
        card.dataset.id = task.id;

        const left = document.createElement('div');
        left.className = 'task-left';

        const checkbox = document.createElement('div');
        checkbox.className = 'task-checkbox' + (task.completed ? ' checked' : '');
        checkbox.innerHTML = task.completed ? '‚úì' : '';
        checkbox.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleTask(task.id);
        });

        const textWrapper = document.createElement('div');
        const title = document.createElement('div');
        title.className = 'task-title' + (task.completed ? ' completed' : '');
        title.textContent = task.title;

        const sub = document.createElement('div');
        sub.className = 'task-sub';
        const respText = task.responsible ? `Resp.: ${task.responsible}. ` : '';
        sub.textContent = respText + (task.description || '');

        textWrapper.appendChild(title);
        textWrapper.appendChild(sub);
        left.appendChild(checkbox);
        left.appendChild(textWrapper);

        const center = document.createElement('div');
        center.className = 'task-center';

        const badgePriority = document.createElement('span');
        badgePriority.className = 'badge ' + (task.priority === 'high' ? 'badge-priority-high' : 'badge-priority-normal');
        badgePriority.textContent = task.priority === 'high' ? 'Alta prioridade' : 'Normal';

        const badgeDue = document.createElement('span');
        badgeDue.className = 'badge ' + (task.due === 'today' ? 'badge-due-today' : 'badge-tag');
        badgeDue.textContent = task.due === 'today' ? 'Hoje' : (task.due === 'week' ? 'Semana' : 'Sem data');

        const badgeTag = document.createElement('span');
        badgeTag.className = 'badge badge-tag';
        badgeTag.textContent = task.tag || 'Geral';

        center.appendChild(badgePriority);
        center.appendChild(badgeDue);
        center.appendChild(badgeTag);

        const right = document.createElement('div');
        right.className = 'task-right';

        const statusPill = document.createElement('span');
        statusPill.className = 'pill-soft ' + (task.completed ? 'yellow' : 'gray');
        statusPill.textContent = task.completed ? 'Conclu√≠da' : 'Pendente';

        const attachmentsPill = document.createElement('span');
        attachmentsPill.className = 'pill-soft gray';
        attachmentsPill.textContent = `${(task.attachments || []).length} arquivo(s)`;

        right.appendChild(statusPill);
        right.appendChild(attachmentsPill);

        card.appendChild(left);
        card.appendChild(center);
        card.appendChild(right);

        card.addEventListener('click', () => {
          openTaskDetails(task.id);
        });

        els.taskList.appendChild(card);
      });

      renderKanban();
      updateCountsAndMetrics();
      renderDetailsPanel();
    }

    function renderKanban() {
      els.kanbanDropzones.forEach(zone => {
        zone.innerHTML = '';
      });

      const backlogTasks = state.tasks.filter(t => (t.status || 'backlog') === 'backlog');
      const doingTasks = state.tasks.filter(t => t.status === 'doing');
      const doneTasks = state.tasks.filter(t => t.status === 'done');

      els.kanbanBacklogCount.textContent = backlogTasks.length;
      els.kanbanDoingCount.textContent = doingTasks.length;
      els.kanbanDoneCount.textContent = doneTasks.length;

      state.tasks.forEach(task => {
        const status = task.status || 'backlog';
        const zone = document.querySelector(`.kanban-dropzone[data-status="${status}"]`);
        if (!zone) return;

        const card = document.createElement('div');
        card.className = 'kanban-card ' + status;
        card.draggable = true;
        card.dataset.id = task.id;

        const title = document.createElement('div');
        title.className = 'kanban-card-title';
        title.textContent = task.title;

        const meta = document.createElement('div');
        meta.className = 'kanban-card-meta';
        const res = task.responsible ? `Resp.: ${task.responsible}` : 'Sem respons√°vel';
        const dueLabel = task.due === 'today' ? 'Hoje' : (task.due === 'week' ? 'Semana' : 'Sem data');
        meta.textContent = `${res} ¬∑ ${dueLabel}`;

        card.appendChild(title);
        card.appendChild(meta);

        card.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', String(task.id));
        });

        card.addEventListener('click', () => {
          openTaskDetails(task.id);
        });

        zone.appendChild(card);
      });
    }

    function updateCountsAndMetrics() {
      const total = state.tasks.length;
      const todayNotDone = state.tasks.filter(t => t.due === 'today' && !t.completed);
      const weekNotDone = state.tasks.filter(t => t.due === 'week' && !t.completed);
      const done = state.tasks.filter(t => t.completed);

      els.countAll.textContent = total;
      els.countToday.textContent = todayNotDone.length;
      els.countWeek.textContent = weekNotDone.length;
      els.countDone.textContent = done.length;

      els.metricTodayLeft.textContent = todayNotDone.length;
      els.metricDone.textContent = done.length;

      const todayTotal = state.tasks.filter(t => t.due === 'today').length;
      const doneToday = state.tasks.filter(t => t.due === 'today' && t.completed).length;

      els.rightDoneToday.textContent = doneToday;
      const percentToday = todayTotal === 0 ? 0 : Math.round((doneToday / todayTotal) * 100);
      els.barDoneToday.style.width = percentToday + '%';

      els.rightTotal.textContent = total;
      els.rightDone.textContent = done.length;
      els.rightPending.textContent = total - done.length;
    }

    function toggleTask(id) {
      const task = state.tasks.find(t => t.id === id);
      if (!task) return;
      task.completed = !task.completed;
      const oldStatus = task.status || 'backlog';
      if (task.completed) {
        task.status = 'done';
        addHistory(task, 'Tarefa marcada como conclu√≠da.');
      } else {
        if (oldStatus === 'done') {
          task.status = 'backlog';
        }
        addHistory(task, 'Tarefa marcada como pendente.');
      }
      renderTasks();
    }

    function openTaskDetails(id) {
      state.currentTaskId = id;
      renderDetailsPanel();
    }

    function renderDetailsPanel() {
      const task = state.tasks.find(t => t.id === state.currentTaskId);
      if (!task) {
        els.detailStatusLabel.textContent = 'Nenhuma tarefa selecionada';
        els.detailTitle.value = '';
        els.detailDesc.value = '';
        els.detailResp.value = '';
        els.detailDate.value = '';
        els.detailPriority.value = 'normal';
        els.detailStatus.value = 'backlog';
        els.attachmentList.innerHTML = '';
        els.historyList.innerHTML = '<div class="detail-small">Selecione uma tarefa para ver o hist√≥rico de altera√ß√µes.</div>';
        return;
      }

      els.detailStatusLabel.textContent = `ID ${task.id} ¬∑ ${task.completed ? 'Conclu√≠da' : 'Em aberto'}`;
      els.detailTitle.value = task.title || '';
      els.detailDesc.value = task.description || '';
      els.detailResp.value = task.responsible || '';
      els.detailPriority.value = task.priority || 'normal';
      els.detailStatus.value = task.status || 'backlog';

      if (task.dueDate) {
        els.detailDate.value = task.dueDate;
      } else {
        els.detailDate.value = '';
      }

      els.attachmentList.innerHTML = '';
      (task.attachments || []).forEach(att => {
        const li = document.createElement('li');
        li.className = 'attachment-item';
        const sizeText = att.sizeKb ? ` ¬∑ ${att.sizeKb} KB` : '';
        li.innerHTML = `<span>${att.name}</span><span>${sizeText}</span>`;
        els.attachmentList.appendChild(li);
      });

      renderHistory(task);
    }

    function renderHistory(task) {
      els.historyList.innerHTML = '';
      if (!task.history || task.history.length === 0) {
        els.historyList.innerHTML = '<div class="detail-small">Sem hist√≥rico ainda. Altera√ß√µes ser√£o registradas aqui.</div>';
        return;
      }

      task.history.forEach(entry => {
        const div = document.createElement('div');
        div.className = 'history-entry';
        const time = document.createElement('div');
        time.className = 'history-time';
        time.textContent = formatDateTime(entry.timestamp);
        const text = document.createElement('div');
        text.className = 'history-text';
        text.textContent = entry.message;
        div.appendChild(time);
        div.appendChild(text);
        els.historyList.appendChild(div);
      });
    }

    function addTaskFromInput() {
      const value = els.newTaskInput.value.trim();
      if (!value) return;
      const newTask = {
        id: Date.now(),
        title: value,
        description: 'Criada rapidamente a partir da barra superior.',
        due: 'today',
        dueDate: null,
        priority: 'normal',
        tag: 'Geral',
        responsible: '',
        completed: false,
        status: 'backlog',
        attachments: [],
        history: []
      };
      addHistory(newTask, 'Tarefa criada.');
      state.tasks.unshift(newTask);
      els.newTaskInput.value = '';
      state.filter = 'all';
      state.currentTaskId = newTask.id;
      renderTasks();
    }

    function clearDoneTasks() {
      state.tasks = state.tasks.filter(t => !t.completed);
      if (state.currentTaskId && !state.tasks.find(t => t.id === state.currentTaskId)) {
        state.currentTaskId = null;
      }
      renderTasks();
    }

    function moveTaskToStatus(id, status) {
      const task = state.tasks.find(t => t.id === id);
      if (!task) return;
      const oldStatus = task.status || 'backlog';
      if (oldStatus === status) return;
      task.status = status;
      if (status === 'done') {
        task.completed = true;
      } else if (oldStatus === 'done' && status !== 'done') {
        task.completed = false;
      }
      addHistory(task, `Status alterado de ${mapStatusLabel(oldStatus)} para ${mapStatusLabel(status)}.`);
      renderTasks();
    }

    function mapStatusLabel(status) {
      if (status === 'backlog') return 'Backlog';
      if (status === 'doing') return 'Em andamento';
      if (status === 'done') return 'Conclu√≠da';
      return status;
    }

    function bindKanbanEvents() {
      els.kanbanDropzones.forEach(zone => {
        zone.addEventListener('dragover', (e) => {
          e.preventDefault();
          zone.classList.add('over');
        });
        zone.addEventListener('dragleave', () => {
          zone.classList.remove('over');
        });
        zone.addEventListener('drop', (e) => {
          e.preventDefault();
          zone.classList.remove('over');
          const id = Number(e.dataTransfer.getData('text/plain'));
          const status = zone.dataset.status;
          moveTaskToStatus(id, status);
        });
      });
    }

    function bindEvents() {
      els.addTaskBtn.addEventListener('click', addTaskFromInput);
      els.newTaskInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          addTaskFromInput();
        }
      });

      els.clearDoneBtn.addEventListener('click', clearDoneTasks);

      els.filters.forEach(filterChip => {
        filterChip.addEventListener('click', () => {
          const filter = filterChip.dataset.filter;
          state.filter = filter;
          els.filters.forEach(f => f.classList.remove('active'));
          filterChip.classList.add('active');
          renderTasks();
        });
      });

      bindKanbanEvents();

      els.detailSaveBtn.addEventListener('click', saveDetailChanges);
      els.detailFiles.addEventListener('change', handleFileAttach);
    }

    function saveDetailChanges() {
      const task = state.tasks.find(t => t.id === state.currentTaskId);
      if (!task) return;

      const changes = [];

      if (els.detailTitle.value.trim() !== task.title) {
        changes.push(`T√≠tulo alterado de "${task.title}" para "${els.detailTitle.value.trim()}".`);
        task.title = els.detailTitle.value.trim();
      }

      if (els.detailDesc.value.trim() !== (task.description || '')) {
        changes.push('Descri√ß√£o atualizada.');
        task.description = els.detailDesc.value.trim();
      }

      if (els.detailResp.value.trim() !== (task.responsible || '')) {
        const oldResp = task.responsible || 'sem respons√°vel';
        const newResp = els.detailResp.value.trim() || 'sem respons√°vel';
        changes.push(`Respons√°vel alterado de "${oldResp}" para "${newResp}".`);
        task.responsible = els.detailResp.value.trim();
      }

      const newDate = els.detailDate.value || null;
      if ((task.dueDate || null) !== newDate) {
        const old = task.dueDate || 'sem data';
        const novo = newDate || 'sem data';
        changes.push(`Data alterada de "${old}" para "${novo}".`);
        task.dueDate = newDate;
      }

      if (els.detailPriority.value !== task.priority) {
        changes.push(`Prioridade alterada de "${task.priority}" para "${els.detailPriority.value}".`);
        task.priority = els.detailPriority.value;
      }

      if ((task.status || 'backlog') !== els.detailStatus.value) {
        const oldStatusLabel = mapStatusLabel(task.status || 'backlog');
        const newStatusLabel = mapStatusLabel(els.detailStatus.value);
        changes.push(`Status alterado de ${oldStatusLabel} para ${newStatusLabel}.`);
        task.status = els.detailStatus.value;
        if (task.status === 'done') {
          task.completed = true;
        } else if (task.completed && task.status !== 'done') {
          task.completed = false;
        }
      }

      if (changes.length > 0) {
        changes.forEach(msg => addHistory(task, msg));
      }

      renderTasks();
      openTaskDetails(task.id);
    }

    function handleFileAttach(event) {
      const task = state.tasks.find(t => t.id === state.currentTaskId);
      if (!task) return;
      const files = Array.from(event.target.files || []);
      if (files.length === 0) return;

      files.forEach(file => {
        const sizeKb = file.size ? Math.round(file.size / 1024) : null;
        if (!task.attachments) task.attachments = [];
        task.attachments.push({
          name: file.name,
          sizeKb
        });
        addHistory(task, `Arquivo anexado: ${file.name}${sizeKb ? ' (' + sizeKb + ' KB)' : ''}.`);
      });

      els.detailFiles.value = '';
      renderTasks();
      openTaskDetails(task.id);
    }

    function init() {
      formatTodayLabel();
      bindEvents();
      renderTasks();
    }

    init();
  </script>
</body>
</html>
